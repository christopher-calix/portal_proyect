<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ValidadorMX ">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="ValidadorMX">
    <link rel="shortcut icon" href="{% static 'img/favicon.png' %}">

    <title>Reseteo de contraseña</title>
    <!-- Bootstrap CSS -->    
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="{% static 'css/bootstrap-theme.css' %}" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="{% static 'css/elegant-icons-style.css' %}" rel="stylesheet" />
    <link href="{% static 'css/font-awesome.css' %}" rel="stylesheet" />
    <!-- Custom styles -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/style-responsive.css' %}" rel="stylesheet" />
    <link href="{% static 'css/jquery.toast.css' %}" rel="stylesheet" />
    <link href="{% static 'css/normalize.css' %}" rel="stylesheet" />
    <link href="{% static 'css/component.css' %}" rel="stylesheet" />
    <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>

    <script type="text/javascript" src="{% static 'js/jquery.toast.js' %}"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

    <body class="login-img3-body">
    <div id="large-header" class="large-header">
        <canvas id="demo-canvas"></canvas>
    </div>

    <div class="container">
      <form id="login_form" class="login-form" autocomplete="off">
      {% csrf_token %}
      <header class="panel-heading text-center panel-relative">
        FORMULARIO | CAMBIO DE CONTRAEÑA
      </header>
      <div class="login-wrap">
        <p class="login-img"><i class="icon_lock_alt"></i></p>
            <div class="input-group">
            <span class="input-group-addon"></span>
              <input type="text" name="message" id="message" class="form-control" disabled style='color: #C00;'>
            </div>
            <div class="input-group">
              <span class="input-group-addon"><i class="fa fa-envelope"></i></span>
              <input id="email" type="text" class="form-control" name="email" placeholder="Correo electronico" autocomplete="off" autofocus required>
            </div>
            <!--<a class="btn btn-primary btn-lg btn-block" id="btn_registrar" title="Descargar XML">Continuar</a>-->
             <button class="btn btn-primary btn-lg btn-block" id="btn_registrar" type="submit">Continuar</button>
             <label class="checkbox">
                <span class="pull-right"> <a href="{% url 'index' %}">¿Ya tienes usuario y contraseña? <strong>Inicia sesión</strong></a></span>
              </label>

        </div>
      </form>

    </div>
        <script src="{% static 'js/TweenLite.min.js' %}"></script>
        <script src="{% static 'js/EasePack.min.js' %}"></script>
        <script src="{% static 'js/demo-1.js' %}"></script>
  </body>
  <script type="text/javascript">
  var token = '{{ csrf_token }}';

$(document).ready(function() {

    document.getElementById('btn_registrar').style.display = 'none';
    var mensaje=document.getElementById("message");



    $('#email').keyup(function(e) {
        e.preventDefault();
        expr = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        var email=document.getElementById("email").value;

        if (email=='') {
          mensaje.value="El campo de Correo es requerido.";
        }
        else if (!expr.test(email)) {
          mensaje.value="Correo electronico no valido";
        }
        else {
          mensaje.value="";
          document.getElementById('btn_registrar').style.display =  null;
        }
    });

    $('#btn_registrar').on('click', function(e) {
        e.preventDefault();
        var email=document.getElementById("email").value;
        
        var data = new FormData()
          data.append('email', email);
          data.append('csrfmiddlewaretoken', token);
          $.ajax({
            type: 'POST',
            url: '/usuarios/back_passreset/',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            dataType: 'json',
          }).done(function(json) {
            
            if(json.success){
              $.toast({
                    heading: 'Success',
                    text: json.message,
                    showHideTransition: 'slide',
                    icon: 'success',
                    position: 'top-right',
                })
              setTimeout('document.location.replace("/")',3000);
            }
            else{
              $.toast({
                    heading: 'Error',
                    text: json.message,
                    showHideTransition: 'slide',
                    icon: 'error',
                    position: 'top-right',
                })
            }

          })
    });

bootstrap_alert = function () {}
bootstrap_alert.warning = function (message, alert, timeout) {
    $('<div id="floating_alert" class="alert alert-' + alert + ' fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>' + message + '&nbsp;&nbsp;</div>').appendTo('body');


    setTimeout(function () {
        $(".alert").alert('close');
    }, timeout);

}



 });
  </script>
</html>